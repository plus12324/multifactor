<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Board Form</title>
<link rel="stylesheet" th:href="@{/css/base.css}" />
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/3.3.4/css/bootstrap.min.css}" />

<script	src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.3.1/jquery.min.js}"></script>
<script	src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/3.3.4/js/bootstrap.min.js}"></script>

<script>
	function ajaxSuccessCallback(data){
		
		$("#userTable > tbody").empty();
		
		$.each(data, function() {			
			var tmpRow = "<tr>";
			tmpRow += "<td>" + data.idx + "</td>";
			tmpRow += "<td>" + data.name + "</td>";
			tmpRow += "<td>" + data.social + "</td>";
			tmpRow += "<td>" + data.createdDate + "</td>";
			tmpRow += "<td>";
			tmpRow += "<button onclick=\"\" class=\"btn btn-success btn-sm\">적용</button>";
			tmpRow += "<button onclick=\"\" class=\"btn btn-danger btn-sm\">삭제</button></td>";
			tmpRow += "</tr>";
			alert(tmpRow);
			$('#userTable > tbody:last').append(tmpRow);
		});
	}
	function test(formName) {
		var param = $("#"+formName).serialize();
		$.ajax({
			type : $("#"+formName).attr("method"),
			url : $("#"+formName).attr("action"),
			data : param,
			success :  function(data) {
				ajaxSuccessCallback(data);
			},
			error : function(data) {
				alert("error");
			}
		});
	}
	
	function getList() {
		$.ajax({
			url : "/admin/userList",
			type : "get",
			//             dataType : "xml",
			success :  function(data) {
				alert(data);
				ajaxSuccessCallback(data);
			},
			error : function name() {
				$("#userListDiv").append("error");
			}
		});
	}

// 	$(document).ready(getList());
</script>

</head>
<body>
	<div th:replace="layout/header::header"></div>

	<div class="container">
		<div class="page-header">
			<h1>사용자 목록</h1>
		</div>

		<a href="javascript:getList()">search</a>
<!-- 		<form th:action="@{/admin/userList}" method="get"> -->
<!-- 			<input class="btn btn-danger" type="submit" value="조회" /> -->
<!-- 		</form> -->

		<br /> <br /> <br />
		<div id="mainHide">
			<table id="userTable" class="table table-hover">
				<thead>
					<tr>
						<th class="col-md-2">#</th>
						<th class="col-md-2">이름</th>
						<th class="col-md-2">권한</th>
						<th class="col-md-2">등록일</th>
						<th class="col-md-2"></th>

					</tr>
				</thead>
				<tbody>
					<tr th:each="user : ${userList}">
						<td th:text="${user.idx}">1</td>
						<td th:text="${user.name}">tester</td>
						<td th:with="user_socialType_value=${user.socialType.value}">
							<select class="select" name="socialType" id="socialType">
								<option>선택</option>
								<option
									th:each="select : ${T(com.web.multifactor.oauth.SocialType).values()}"
									th:value="${select}"
									th:text="${select} + ' : ' + ${select.value}"
									th:selected="${user_socialType_value} == ${select.value}"></option>
							</select>

						</td>
						<!--<td><a th:href="'/board?idx='+${user.idx}"	th:text="${user.name}"></a></td> -->
						<td th:text="${user.createdDate} ? ${#temporals.format(user.createdDate,'yyyy-MM-dd')} : ${user.createdDate}"></td>
						<td>
							<button onclick="" class="btn btn-success btn-sm">적용</button>
							<button onclick="test('delForm')" class="btn btn-danger btn-sm">삭제</button>
							<form id="delForm" action="/admin/userDel" method="post">
								<input type="hidden" name="idx" th:value="${user.idx}"/>
							</form>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<br />

		<!-- Pagination -->
		<!--         <nav aria-label="Page navigation" style="text-align:center;"> -->
		<!--             <ul class="pagination" th:with="startNumber=${T(Math).floor(boardList.number/10)}*10+1, endNumber=(${boardList.totalPages} > ${startNumber}+9) ? ${startNumber}+9 : ${boardList.totalPages}"> -->
		<!--                 <li><a aria-label="Previous" href="/board/list?page=1">&laquo;</a></li> -->
		<!--                 <li th:style="${boardList.first} ? 'display:none'"> -->
		<!--                     <a th:href="@{/board/list(page=${boardList.number})}">&lsaquo;</a> -->
		<!--                 </li> -->

		<!--                 <li th:each="page :${#numbers.sequence(startNumber, endNumber)}" th:class="(${page} == ${boardList.number}+1) ? 'active'"> -->
		<!--                     <a th:href="@{/board/list(page=${page})}" th:text="${page}"><span class="sr-only"></span></a> -->
		<!--                 </li> -->

		<!--                 <li th:style="${boardList.last} ? 'display:none'"> -->
		<!--                     <a th:href="@{/board/list(page=${boardList.number}+2)}">&rsaquo;</a> -->
		<!--                 </li> -->
		<!--                 <li><a aria-label="Next" th:href="@{/board/list(page=${boardList.totalPages})}">&raquo;</a></li> -->
		<!--             </ul> -->
		<!--         </nav> -->
		<!-- /Pagination -->
	</div>

	<div th:replace="layout/footer::footer"></div>
</body>
</html>